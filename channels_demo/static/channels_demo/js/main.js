/*! For license information please see index.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("React"),require("ReactDOM"));else if("function"==typeof define&&define.amd)define(["React","ReactDOM"],t);else{var r="object"==typeof exports?t(require("React"),require("ReactDOM")):t(e.React,e.ReactDOM);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,((e,t)=>(()=>{"use strict";var r={251:(e,t,r)=>{var n=r(24),o=Symbol.for("react.element"),i=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,r){var n,u={},c=null,f=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(f=t.ref),t)i.call(t,n)&&!a.hasOwnProperty(n)&&(u[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===u[n]&&(u[n]=t[n]);return{$$typeof:o,type:e,key:c,ref:f,props:u,_owner:s.current}}},893:(e,t,r)=>{e.exports=r(251)},24:t=>{t.exports=e},314:e=>{e.exports=t}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return r[e](i,i.exports,o),i.exports}o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{o.r(i);var e=o(24),t=o(314),r=Object.defineProperty,n=(e,t,n)=>(((e,t,n)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const s={string:{stringify:e=>e,parse:e=>e},number:{stringify:e=>`${e}`,parse:e=>parseFloat(e)},boolean:{stringify:e=>e?"true":"false",parse:e=>/^[ty1-9]/i.test(e)},function:{stringify:e=>e.name,parse:(e,t)=>{const r=typeof window<"u"&&e in window?window[e]:typeof global<"u"&&e in global?global[e]:void 0;return"function"==typeof r?r.bind(t):void 0}},json:{stringify:e=>JSON.stringify(e),parse:e=>JSON.parse(e)}},a=Symbol.for("r2wc.render"),u=Symbol.for("r2wc.connected"),c=Symbol.for("r2wc.context"),f=Symbol.for("r2wc.props");function l(e=""){return e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}var p,d=t;function y(t,r,n){const o=p(t),i=e.createElement(r,n);return o.render(i),{root:o,ReactComponent:r}}function h({root:t,ReactComponent:r},n){const o=e.createElement(r,n);t.render(o)}function m({root:e}){e.unmount()}p=d.createRoot,d.hydrateRoot;var v=o(893);function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,s,a=[],u=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var w=function(e,t={}){return function(e,t,r){var o,i,p;t.props||(t.props=e.propTypes?Object.keys(e.propTypes):[]);const d=(Array.isArray(t.props)?t.props.slice():Object.keys(t.props)).filter((e=>"container"!==e)),y={},h={},m={};for(const e of d){y[e]=Array.isArray(t.props)?"string":t.props[e];const r=l(e);h[e]=r,m[r]=e}class v extends HTMLElement{constructor(){super(),n(this,o,!0),n(this,i),n(this,p,{}),n(this,"container"),t.shadow?this.container=this.attachShadow({mode:t.shadow}):this.container=this,this[f].container=this.container;for(const e of d){const t=h[e],r=this.getAttribute(t),n=y[e],o=s[n];r&&null!=o&&o.parse&&(this[f][e]=o.parse(r,this))}}static get observedAttributes(){return Object.keys(m)}connectedCallback(){this[u]=!0,this[a]()}disconnectedCallback(){this[u]=!1,this[c]&&r.unmount(this[c])}attributeChangedCallback(e,t,r){const n=m[e],o=y[n],i=s[o];n in y&&null!=i&&i.parse&&(this[f][n]=i.parse(r,this),this[a]())}[(o=u,i=c,p=f,a)](){this[u]&&(this[c]?r.update(this[c],this[f]):this[c]=r.mount(this.container,e,this[f]))}}for(const e of d){const t=h[e],r=y[e];Object.defineProperty(v.prototype,e,{enumerable:!0,configurable:!0,get(){return this[f][e]},set(n){this[f][e]=n;const o=s[r];if(null!=o&&o.stringify){const e=o.stringify(n);this.getAttribute(t)!==e&&this.setAttribute(t,e)}}})}return v}(e,t,{mount:y,update:h,unmount:m})}((function(){var t=(0,e.useRef)(null),r=g((0,e.useState)({width:0,height:0}),2),n=r[0],o=(r[1],g((0,e.useState)([]),2)),i=o[0],s=o[1],a=g((0,e.useState)(null),2),u=a[0],c=a[1],f=(0,e.useRef)(i),l=(0,e.useRef)(u),p=(0,e.useRef)(null),d=(0,e.useRef)(null),y=(0,e.useRef)(null),h=(0,e.useRef)(null),m=1e3,b=1e3;(0,e.useEffect)((function(){var e=new Image;e.onload=function(){return y.current=e},e.src="/static/channels_demo/images/sprite-idle.png";var t=new Image;t.onload=function(){return d.current=t},t.src="/static/channels_demo/images/sprite-move.png"}),[]);var w=function(){var e=t.current,r=e.getContext("2d"),n=e.parentNode.getBoundingClientRect(),o=window.devicePixelRatio||1;e.width=n.width,e.height=n.height,r.setTransform(e.width/m*o,0,0,e.height/b*o,0,0)},S=function(e){var t=JSON.parse(e.data);"stateUpdate"===t.type?s(t.objects):"playerId"===t.type&&c(t.playerId)},O=function(e){0===e.button&&l.current&&h.current.send(JSON.stringify({type:"mouseDown",playerId:l.current}))},R=function(e){0===e.button&&l.current&&h.current.send(JSON.stringify({type:"mouseUp",playerId:l.current}))},E=function e(r){p.current=requestAnimationFrame(e);var n=t.current.getContext("2d");n.clearRect(0,0,m,b),n.fillStyle="black",n.fillRect(0,0,m,b),f.current.forEach((function(e){return function(e,t){if(d.current){e.save(),e.translate(t.x,t.y),e.rotate(t.facing);var r=t.thrusting?d.current:y.current;e.drawImage(r,0,0,187,94,-46.75,-23.5,187/3,94/3),e.restore()}}(n,e)}))};return(0,e.useEffect)((function(){f.current=i}),[i]),(0,e.useEffect)((function(){l.current=u}),[u]),(0,e.useEffect)((function(){var e={x:0,y:0},r=function(r){var n=t.current,o=n.getBoundingClientRect(),i=n.width/o.width,s=n.height/o.height;e.x=(r.clientX-o.left)*i,e.y=(r.clientY-o.top)*s};window.addEventListener("mousemove",r);var n=setInterval((function(){var r=l.current,n=f.current;if(r){var o,i,s,a,u=n.find((function(e){return e.id===r}));if(u){var c=(o=u.x,i=u.y,s=e.x*(m/t.current.width)-o,a=e.y*(b/t.current.height)-i,Math.atan2(a,s));h.current.send(JSON.stringify({type:"facing",playerId:r,facing:c}))}}}),50);return function(){clearInterval(n),window.removeEventListener("mousemove",r)}}),[]),(0,e.useEffect)((function(){var e=t.current;return h.current=new WebSocket("wss://circumeo.io:8443/ws/game/"),h.current.onmessage=S,e.addEventListener("mousedown",O),e.addEventListener("mouseup",R),p.current=requestAnimationFrame(E),function(){cancelAnimationFrame(p.current),e.removeEventListener("mousedown",O),e.removeEventListener("mouseup",R),h.current.close()}}),[]),(0,e.useEffect)((function(){return w(),window.addEventListener("resize",w),function(){window.removeEventListener("resize",w)}}),[n]),(0,v.jsx)("canvas",{ref:t})}),{props:{}});customElements.define("multiplayer-channels-demo",w)})(),i})()));